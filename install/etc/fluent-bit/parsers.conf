#-----------------------------------------------------------------------------
# Fluent Bit Parsers Configuration
#
# Purpose: Define log parsing patterns for various log formats and sources
# Context: Used by Fluent Bit for structured log processing and forwarding
# Note: Captures common fields: time, severity, host, ident, pid, message
#-----------------------------------------------------------------------------



#-----------------------------------------------------------------------------
# APPLICATION & CUSTOM PARSERS
#-----------------------------------------------------------------------------
# Parser for custom application logs with structured format
[PARSER]
    Name         fluentbit
    Format       regex
    Regex        ^\[(?<time>[^\]]*)\] \[(?<severity>[^\]]*)\] \[(?<category>[^\]]*)\] (?<message>.*)
    Time_Key     time
    Time_Format  %Y/%m/%d %H:%M:%S

# Parser for JSON formatted logs
[PARSER]
    Name         json
    Format       json
    # Time_Key     time          # Uncomment if JSON logs contain timestamp
    # Time_Format  %d/%b/%Y:%H:%M:%S %z  # Adjust format as needed

#-----------------------------------------------------------------------------
# SYSLOG STANDARD PARSERS
#-----------------------------------------------------------------------------
# RFC 5424 syslog parser (modern syslog standard)
[PARSER]
    Name         syslog-rfc5424
    Format       regex
    Regex        ^\<(?<pri>[0-9]{1,5})\>1 (?<time>[^ ]+) (?<host>[^ ]+) (?<ident>[^ ]+) (?<pid>[-0-9]+) (?<msgid>[^ ]+) (?<extradata>(\[(.*?)\]|-)) (?<message>.+)$
    Time_Key     time
    Time_Format  %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep    On

# RFC 3164 syslog parser for local logs (BSD style)
[PARSER]
    Name         syslog-rfc3164-local
    Format       regex
    Regex        ^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$
    Time_Key     time
    Time_Format  %b %d %H:%M:%S
    Time_Keep    On

# RFC 3164 syslog parser for network logs (BSD style with host)
[PARSER]
    Name         syslog-rfc3164
    Format       regex
    Regex        ^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-]*)(?:\[(?<pid>[0-9]+)\])?(?:[^\:]*\:)? *(?<message>.*)$
    Time_Key     time
    Time_Format  %b %d %H:%M:%S
    Time_Keep    On

#-----------------------------------------------------------------------------
# MONITORING AGENT PARSERS
#-----------------------------------------------------------------------------
# Parser for classic Zabbix agent logs
[PARSER]
    Name         zabbix-agent-classic
    Format       regex
    Regex        ^  (?<pid>[0-9]+):(?<time>[^ ]+) *(?<message>.*)
    Time_Key     time
    # Time_Format  %Y%m%d:%H%M:%S    # Uncomment and verify format for your Zabbix version

# Parser for modern Zabbix agent logs
[PARSER]
    Name         zabbix-agent-modern
    Format       regex
    Regex        ^(?<time>[^ ]+ [^ ]+ [^ ]+) *(?<message>.*)$
    Time_Key     time
    # Time_Format  %Y/%m/%d %H:%M:%S  # Uncomment and verify format for your Zabbix version
